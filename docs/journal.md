# 仕訳

next vone では、仕訳関連のカスタマイズを安易に受けられないため、オプションを豊富に用意し、設定のみで様々な仕訳が行えるようにする必要がある

## 解決すべき課題

### トランザクション系テーブルでの不足項目

|table         |テーブル  |column         |カラム      |
|:-------------|:---------|:--------------|:-----------|
|Receipt       |入金      |DepartmentId   |請求部門ID  |
|Receipt       |入金      |TaxAmount      |税額        |
|Receipt       |入金      |TaxClassId     |税区分      |
|ReceiptExclude|入金対象外|DepartmentId   |請求部門ID  |
|ReceiptExclude|入金対象外|TaxAmount      |税額        |
|ReceiptExclude|入金対象外|TaxClassId     |税区分      |

消込時の 消費税誤差 や、 手数料 で、２回クエリを実行するなど もってのほか

消込時に、適切なダミー請求/入金データを作成して対応する

ダミー請求/入金データへ期待する動作

*   データ検索画面での取り扱い表示するようにするかどうか
*   消込解除時の自動削除
*   請求/入金 仕訳の出力対象からの除外

通過勘定を挟む/挟まないの設定を、科目の相手先科目設定で可能となるかどうか


相殺系の詳細な仕訳を出力したい場合ほど、入金側の税区分や、税額が必要になる

### 通過勘定の利用有無

個別の入金区分によって、通過勘定を利用したくないという要件が想定される

しかし、仕訳出力対象の抽出処理で、区分を参照するのはクエリのパフォーマンスを考えると難しい

## 一般的な会計システムで必要となる項目

*   伝票番号
*   行番号
*   借方 科目コード
*   借方 補助コード
*   借方 部門コード
*   借方 得意先（取引先）コード
*   借方 金額
*   借方 税額
*   借方 税区分
*   借方 摘要
*   貸方 科目コード
*   貸方 補助コード
*   貸方 部門コード
*   貸方 得意先（取引先）コード
*   貸方 金額
*   貸方 税額
*   貸方 税区分
*   貸方 摘要

## 特定項目での集計機能

vone の場合、消込（Matching）処理で、n対nの組み合わせが発生する

この場合は、下記のような複合仕訳を要求されることが多い

|伝票番号|伝票日付  |借方科目|借方金額|貸方科目|貸方金額|
|-------:|:--------:|:-------|-------:|:-------|-------:|
|       1|2019-02-10|預金    |  60,000|売掛金  |  20,000|
|        |          |        |        |売掛金  |  20,000|
|        |          |        |        |売掛金  |  20,000|

下記のような場合もある

|伝票番号|伝票日付  |借方科目|借方金額|貸方科目|貸方得意先|貸方金額|
|-------:|:--------:|:-------|-------:|:-------|:---------|-------:|
|       1|2019-02-10|預金    |  60,000|諸口    |代表得意先|  60,000|
|       1|2019-02-10|諸口    |  20,000|売掛金  |得意先A   |  20,000|
|       1|2019-02-10|諸口    |  20,000|売掛金  |得意先B   |  20,000|
|       1|2019-02-10|諸口    |  20,000|売掛金  |得意先C   |  20,000|

上記のようなパターンを、仕訳明細出力設定で、定義できるように考慮する必要がある


※ 科目単位で設定するべき項目

伝票番号 発番マスター

訂正仕訳の出力

訂正仕訳の出力形式

パターン


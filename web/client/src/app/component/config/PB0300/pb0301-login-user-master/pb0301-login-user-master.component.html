<div [formGroup]="myFormGroup" class="department-master">
  <section class="contentsButton">

    <div class="contentsButton__inner">
      <!--- 処理結果の表示 -->
      <app-parts-result-message [processCustomResult]="processCustomResult"></app-parts-result-message>

      <button 
        (click)="panelOpenState=!panelOpenState;panelOpenState?panel.open():panel.close();"
        class="buttonPrimary">
        {{panelOpenState?ItemNameConst.BTN_INPUT_ITEM_HIDDEN:ItemNameConst.BTN_INPUT_ITEM_DISPLAY}}</button>

      <div class="contentsButton__subSection">
        <ng-container *ngIf="securityHideShow">
          <ng-container *ngIf="userInfoService.isFunctionAvailable(FunctionType.MasterImport)">
            <button class="buttonImport infotip"
              (click)="buttonAction(BUTTON_ACTION.IMPORT)">
              <span [innerHtml]="ButtonTipsConst.CSV_IMPORT | safeHtml_pipe" class="infotip__frame"></span>
            </button>
          </ng-container>
          <ng-container *ngIf="userInfoService.isFunctionAvailable(FunctionType.MasterExport)">
            <button class="buttonExport infotip"
              (click)="buttonAction(BUTTON_ACTION.EXPORT)">
              <span [innerHtml]="ButtonTipsConst.CSV_EXPORT | safeHtml_pipe" class="infotip__frame"></span>
            </button>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </section>

  <section class="pageContainer">

    <!-- 入力フォーム -->
    <mat-expansion-panel
      #panel
      [hideToggle]="true">
      <ng-template matExpansionPanelContent>

      <section [ngClass]="!panelOpenState ? 'contents--hidden' : 'contents--visible'">
        <div class="contents__container--flex">
          <div class="contents__item--w-55">
            <dl class="definitionForm">
              <dt class="definitionForm__title w--21">ユーザーコード<span class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
              <dd class="definitionForm__data w--79">
                <input
                  formControlName="userCodeCtrl"
                  name="userCodeCtrl"
                  (keyup.enter)="setUserCode($event.type)"
                  (blur)="setUserCode($event.type)"
                  maxlength="{{userInfoService.ApplicationControl?.loginUserCodeLength}}"
                  type="tel"
                  class="input-size--100 input-uppercase">
              </dd>
              <dt class="definitionForm__title w--21">ユーザー名<span class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
              <dd class="definitionForm__data w--79">
                <input
                  formControlName="userNameCtrl"
                  name="userNameCtrl"
                  (keyup.enter)="setUserName($event.type)"
                  maxlength="40"
                  class="input-size--400">
              </dd>
              <dt class="definitionForm__title w--21">請求部門<span class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
              <dd class="definitionForm__data w--79">
                <input
                  formControlName="departmentCodeCtrl"
                  name="departmentCodeCtrl"
                  (keyup.enter)="setDepartmentCode($event.type)"
                  (blur)="setDepartmentCode($event.type)"
                  #departmentCodeInput
                  [formControl]="departmentCodeCtrl"
                  [matAutocomplete]="autoDepartment"
                  maxlength="{{userInfoService.ApplicationControl?.departmentCodeLength}}"
                  type="tel"
                  placeholder="{{PlaceHolderConst.F9_SEARCH}}"
                  class="input-size--100 definitionForm__input">
                <mat-autocomplete
                  #autoDepartment="matAutocomplete"
                  [panelWidth]="PanelConst.autocompleteWidth300">
                  <mat-option
                    *ngFor="let department of departmentFilterds[0] | async"
                    [value]="department.code">
                    {{department.code}}:{{department.name}}
                  </mat-option>
                </mat-autocomplete>
                <a class="buttonMasterSearch" (click)="openMasterModal(TABLE_INDEX.MASTER_DEPARTMENT)"></a>
                <input
                  formControlName="departmentNameCtrl"
                  name="departmentNameCtrl"
                  class="input-size--360"
                  readonly>
              </dd>
              <dt class="definitionForm__title w--21">メールアドレス</dt>
              <dd class="definitionForm__data w--79">
                <input
                  formControlName="mailCtrl"
                  name="mailCtrl"
                  (keyup.enter)="setMail($event.type)"
                  [ngClass]="{'input--error': mailCtrl.errors?.email}"
                  maxlength="254"
                  type="tel"
                  class="input-size--400">
                  <br>
                  <div
                    class="message-result font__warning" *ngIf="mailCtrl.errors?.email">
                    {{ MSG_VAL.MAIL }}
                  </div>
              </dd>
              <dt class="definitionForm__title w--21">
                <div class="inputStyled">
                  <input class="inputStyled__input"
                    id="cbxInitializePasswordCtrl_01"
                    formControlName="cbxInitializePasswordCtrl"
                    name="cbxInitializePasswordCtrl"
                    (change)="selectPassword()"
                    type="checkbox">
                  <label class="inputStyled__checkbox"
                    for="cbxInitializePasswordCtrl_01">パスワード初期化</label>
                </div>
              </dt>
              <dd class="definitionForm__data w--79">
                <dl class="definitionForm">
                  <dt class="definitionForm__title w--22">初回パスワード</dt>
                  <dd class="definitionForm__data w--78">
                    <input
                      formControlName="initialPasswordCtrl"
                      name="initialPasswordCtrl"
                      (keyup.enter)="setInitialPassword($event.type)"
                      maxlength="15"
                      type="password"
                      class="input-size--200">
                  </dd>
                  <dt class="definitionForm__title w--22 align--right">（確認）</dt>
                  <dd class="definitionForm__data w--78">
                    <input
                      formControlName="initialPasswordConfirmationCtrl"
                      name="initialPasswordConfirmationCtrl"
                      (keyup.enter)="setInitialPasswordConfirmation($event.type)"
                      [ngClass]="{'input--error': initialPasswordConfirmationCtrl.errors?.equalTo}"
                      maxlength="15"
                      type="password"
                      class="input-size--200">
                      <br>
                      <div
                        class="message-result font__warning"
                        *ngIf="initialPasswordConfirmationCtrl.errors?.equalTo">
                        {{ MSG_VAL.EQUAL_TO_PASSWORD }}
                      </div>
                  </dd>
                </dl>
              </dd>
            </dl>
          </div>
          <div class="contents__item--w-45">
            <dl class="definitionForm">
              <dt class="definitionForm__title w--21">営業担当者</dt>
              <dd class="definitionForm__data w--79 pr--0">
                <input
                  formControlName="staffCodeCtrl"
                  name="staffCodeCtrl"
                  (keyup.enter)="setStaffCode($event.type)"
                  (blur)="setStaffCode($event.type)"
                  #staffCodeInput
                  [formControl]="staffCodeCtrl"
                  [matAutocomplete]="autoStaffCode"
                  placeholder="{{PlaceHolderConst.F9_SEARCH}}"
                  maxlength="{{userInfoService.ApplicationControl?.staffCodeLength}}"
                  type="tel"
                  class="input-size--80 definitionForm__input">
                <mat-autocomplete
                  #autoStaffCode="matAutocomplete"
                  [panelWidth]="PanelConst.autocompleteWidth300">
                  <mat-option
                    *ngFor="let staff of staffFilterds[0] | async"
                    [value]="staff.code">
                    {{staff.code}}:{{staff.name}}
                  </mat-option>
                </mat-autocomplete>
                <a class="buttonMasterSearch" (click)="openMasterModal(TABLE_INDEX.MASTER_STAFF)"></a>
                <input
                  formControlName="staffNameCtrl"
                  name="staffNameCtrl"
                  class="input-size--320"
                  readonly>
              </dd>
              <dt class="definitionForm__title w--21">権限レベル<span class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
              <dd class="definitionForm__data">
                <input
                  formControlName="menuLevelCtrl"
                  name="menuLevelCtrl"
                  (keyup.enter)="setMenuLevel($event.type)"
                  (blur)="setMenuLevel($event.type)"
                  maxlength="1"
                  type="tel"
                  class="input-size--30 definitionForm__input">
                <ng-container *ngIf="userInfoService.ApplicationControl?.useDistribution==1">
                  <div class="inputStyled">
                    <input
                      id="cbxUseClientCtrl"
                      class="inputStyled__input"
                      formControlName="cbxUseClientCtrl"
                      name="cbxUseClientCtrl"
                      type="checkbox">
                    <label
                      class="inputStyled__checkbox"
                      for="cbxUseClientCtrl">V-ONE利用</label>
                  </div>
                </ng-container>
              </dd>
              <dt class="definitionForm__title">セキュリティ<span class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
              <dd class="definitionForm__data">
                <input
                  formControlName="functionLevelCtrl"
                  name="functionLevelCtrl"
                  (keyup.enter)="setFunctionLevel($event.type)"
                  (blur)="setFunctionLevel($event.type)"
                  maxlength="1"
                  type="tel"
                  class="input-size--30">
              </dd>
            </dl>
          </div>
          <div class="contents__buttonGroup">
            <button
              (click)="buttonAction(BUTTON_ACTION.REGISTRY)"
              [ngClass]="{'button-disable': myFormGroup.invalid}"
              class="buttonSecondary">{{ComponentStatus==COMPONENT_STATUS_TYPE.CREATE?ItemNameConst.BTN_REGISTRY:ItemNameConst.BTN_UPDATE}}</button>
            <button
              (click)="buttonAction(BUTTON_ACTION.DELETE)"
              [ngClass]="{'button-disable': DeleteButtonDisableFlag}"
              class="buttonMinimum">{{ItemNameConst.BTN_DELETE}}</button>
            <button
              (click)="clear();processResultService.clearProcessCustomMsg(processCustomResult)"
              class="buttonMinimum">{{ItemNameConst.BTN_CLEAR}}</button>
          </div>
        </div>
      </section>        

      </ng-template>
    </mat-expansion-panel>

    <!-- 登録済みのログインユーザー名 -->
    <section class="contents">
      <h2 class="contents__title--underline-slim">{{ItemNameConst.LBL_REGISTER_LOGIN_USER}}</h2>
      <div class="contents__container">
        <div class="common-inner-table">
          <table>
            <thead>
              <tr>
                <th class="{{TableColumn.COL_50_CODE}}">編集</th>
                <th class="{{TableColumn.COL_150_CODE}}">ユーザコード</th>
                <th class="{{TableColumn.COL_300_CODE}}">ユーザー名</th>
                <th class="{{TableColumn.COL_300_CODE}}">請求部門名</th>
                <th class="{{TableColumn.COL_100_CODE}}">権限</th>
                <th class="{{TableColumn.COL_100_CODE}}">セキュリティ</th>
                <th class="{{TableColumn.COL_300_CODE}}">メールアドレス</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let user of usersResult?.users; let i = index" 
                class="line-selector">
                <td class="{{TableColumn.COL_50_CENTER_NAME}}">
                    <a class="buttonEdit" (click)="selectLine(i)"></a>
                </td>
                <td class="{{TableColumn.COL_150_CENTER_NAME}}">{{user.code}}</td>
                <td class="{{TableColumn.COL_300_NAME}}">{{user.name}}</td>
                <td class="{{TableColumn.COL_300_NAME}}">{{user.departmentName}}</td>
                <td class="{{TableColumn.COL_100_RIGHT_NAME}}">{{user.menuLevel}}</td>
                <td class="{{TableColumn.COL_100_RIGHT_NAME}}">{{user.functionLevel}}</td>
                <td class="{{TableColumn.COL_300_NAME}}">{{user.mail}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>


  </section>
</div>
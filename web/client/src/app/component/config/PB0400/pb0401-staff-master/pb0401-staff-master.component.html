<div [formGroup]="myFormGroup" class="department-master">
  <section class="contentsButton">
    <div class="contentsButton__inner">

      <!--- 処理結果の表示 -->
      <app-parts-result-message [processCustomResult]="processCustomResult"></app-parts-result-message>

      <button
        (click)="panelOpenState=!panelOpenState;panelOpenState?panel.open():panel.close();"
        class="buttonPrimary">
        {{panelOpenState?ItemNameConst.BTN_INPUT_ITEM_HIDDEN:ItemNameConst.BTN_INPUT_ITEM_DISPLAY}}</button>  
        
      <div class="contentsButton__subSection">
        <ng-container *ngIf="securityHideShow">
          <ng-container *ngIf="userInfoService.isFunctionAvailable(FunctionType.MasterImport)">
            <button class="buttonImport infotip"
              (click)="buttonAction(BUTTON_ACTION.IMPORT)">
              <span [innerHtml]="ButtonTipsConst.CSV_IMPORT | safeHtml_pipe" class="infotip__frame"></span>
            </button>
          </ng-container>
          <ng-container *ngIf="userInfoService.isFunctionAvailable(FunctionType.MasterExport)">
            <button class="buttonExport infotip"
              (click)="buttonAction(BUTTON_ACTION.EXPORT)">
              <span [innerHtml]="ButtonTipsConst.CSV_EXPORT | safeHtml_pipe" class="infotip__frame"></span>
            </button>
          </ng-container>
        </ng-container>
      </div>  

    </div>
  </section>

  <section class="pageContainer">
    <!-- 入力フォーム -->
    <mat-expansion-panel
      #panel
      [hideToggle]="true">
      <ng-template matExpansionPanelContent>
        <section [ngClass]="!panelOpenState ? 'contents--hidden' : 'contents--visible'">
          <div class="contents__container--flex">
            <div class="contents__item--w-50">
              <dl class="definitionForm">
                <dt class="definitionForm__title w--25">営業担当者コード<span
                    class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
                <dd class="definitionForm__data w--70">
                  <input
                    formControlName="staffCodeCtrl"
                    name="staffCodeCtrl"
                    (keyup.enter)="setStaffCode($event.type)"
                    (blur)="setStaffCode($event.type)"
                    maxlength="{{userInfoService.ApplicationControl?.staffCodeLength}}"
                    type="tel"
                    class="input-size--100 input-uppercase">
                </dd>
                <dt class="definitionForm__title w--25">営業担当者名<span
                    class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
                <dd class="definitionForm__data w--70">
                  <input
                    formControlName="staffNameCtrl"
                    name="staffNameCtrl"
                    (keyup.enter)="setStaffName($event.type)"
                    maxlength="40"
                    class="input-size--400">
                </dd>
                <dt class="definitionForm__title w--25">請求部門コード<span
                    class="must_have_icon">{{ItemNameConst.LBL_REQUIRED}}</span></dt>
                <dd class="definitionForm__data w--70">
                  <input
                    formControlName="departmentCodeCtrl"
                    name="departmentCodeCtrl"
                    (keyup.enter)="setDepartmentCode($event.type)"
                    (blur)="setDepartmentCode($event.type)"
                    #departmentCodeInput
                    [formControl]="departmentCodeCtrl"
                    [matAutocomplete]="autoDepartment"
                    maxlength="{{userInfoService.ApplicationControl?.departmentCodeLength}}"
                    type="tel"
                    placeholder="{{PlaceHolderConst.F9_SEARCH}}"
                    class="input-size--100 definitionForm__input">
                  <mat-autocomplete
                    #autoDepartment="matAutocomplete"
                    [panelWidth]="PanelConst.autocompleteWidth300">
                    <mat-option
                      *ngFor="let department of departmentFilterds[0] | async"
                      [value]="department.code">
                      {{department.code}}:{{department.name}}
                    </mat-option>
                  </mat-autocomplete>
                  <a
                    class="buttonMasterSearch"
                    (click)="openMasterModal(TABLE_INDEX.MASTER_DEPARTMENT)"></a>
                  <input
                    formControlName="departmentNameCtrl"
                    name="departmentNameCtrl"
                    class="input-size--250"
                    readonly>
                </dd>
                <dt class="definitionForm__title w--25">メールアドレス</dt>
                <dd class="definitionForm__data w--70">
                  <input
                    formControlName="mailCtrl"
                    name="mailCtrl"
                    (keyup.enter)="setMail($event.type)"
                    [ngClass]="{'input--error': mailCtrl.errors?.email}"
                    maxlength="254"
                    type="tel"
                    class="input-size--400">
                  <br>
                  <div
                    class="message-result font__warning"
                    *ngIf="mailCtrl.errors?.email">
                    {{ MSG_VAL.MAIL }}
                  </div>
                </dd>
              </dl>
            </div>
            <div class="contents__item--w-50">
              <dl class="definitionForm">
                <dt class="definitionForm__title">電話番号</dt>
                <dd class="definitionForm__data">
                  <input
                    formControlName="telCtrl"
                    name="telCtrl"
                    (keyup.enter)="setTel($event.type)"
                    [ngClass]="{'input--error': telCtrl.errors?.pattern}"
                    maxlength="20"
                    type="tel"
                    class="input-size--120">
                </dd>
                <br>
                <div
                  class="message-result font__warning"
                  *ngIf="telCtrl.errors?.pattern">
                  {{ MSG_VAL.PATTERN_TEL }}
                </div>
                <dt class="definitionForm__title">FAX番号</dt>
                <dd class="definitionForm__data">
                  <input
                    formControlName="faxCtrl"
                    name="faxCtrl"
                    (keyup.enter)="setFax($event.type)"
                    [ngClass]="{'input--error': faxCtrl.errors?.pattern}"
                    maxlength="20"
                    type="tel"
                    class="input-size--120">
                  <br>
                  <div
                    class="message-result font__warning"
                    *ngIf="faxCtrl.errors?.pattern">
                    {{ MSG_VAL.PATTERN_TEL }}
                  </div>
                </dd>
              </dl>
            </div>
            <div class="contents__buttonGroup">
              <button
                (click)="buttonAction(BUTTON_ACTION.REGISTRY)"
                [ngClass]="{'button-disable': myFormGroup.invalid}"
                class="buttonSecondary">
                {{ComponentStatus==COMPONENT_STATUS_TYPE.CREATE?ItemNameConst.BTN_REGISTRY:ItemNameConst.BTN_UPDATE}}</button>
              <button
                (click)="buttonAction(BUTTON_ACTION.DELETE)"
                [ngClass]="{'button-disable': DeleteButtonDisableFlag}"
                class="buttonMinimum">{{ItemNameConst.BTN_DELETE}}</button>
              <button
                (click)="clear();processResultService.clearProcessCustomMsg(processCustomResult)"
                class="buttonMinimum">{{ItemNameConst.BTN_CLEAR}}</button>
            </div>
          </div>
        </section>
      </ng-template>
    </mat-expansion-panel>

    <!-- 登録済みの営業担当者 -->
    <section class="contents">
      <h2 class="contents__title--underline-slim">{{ItemNameConst.LBL_REGISTER_STAFF}}</h2>
      <div class="contents__container">
      <div class="common-inner-table">
        <table>
          <thead>
            <tr>
              <th class="{{TableColumn.COL_50_CODE}}">編集</th>
              <th class="{{TableColumn.COL_150_CODE}}">営業担当者コード</th>
              <th class="{{TableColumn.COL_200_CODE}}">営業担当者名</th>
              <th class="{{TableColumn.COL_150_CODE}}">請求部門コード</th>
              <th class="{{TableColumn.COL_200_CODE}}">請求部門名</th>
              <th class="{{TableColumn.COL_180_CODE}}">メールアドレス</th>
              <th class="{{TableColumn.COL_180_CODE}}">電話番号</th>
              <th class="{{TableColumn.COL_180_CODE}}">Fax番号</th>
            </tr>
          </thead>
          <tbody>
            <tr 
              *ngFor="let staff of staffsResult?.staffs; let i = index" 
              class="line-selector">
              <td class="{{TableColumn.COL_50_CENTER_NAME}}">
                  <a class="buttonEdit" (click)="selectLine(i)"></a>
              </td>
              <td class="{{TableColumn.COL_150_CENTER_NAME}}">{{staff.code}}</td>
              <td class="{{TableColumn.COL_200_NAME}}">{{staff.name}}</td>
              <td class="{{TableColumn.COL_150_CENTER_NAME}}">{{staff.departmentCode}}</td>
              <td class="{{TableColumn.COL_200_NAME}}">{{staff.departmentName}}</td>
              <td class="{{TableColumn.COL_180_NAME}}">{{staff.mail}}</td>
              <td class="{{TableColumn.COL_180_NAME}}">{{staff.tel}}</td>
              <td class="{{TableColumn.COL_180_NAME}}">{{staff.fax}}</td>
            </tr>
          </tbody>
        </table>
      </div>
      </div>
    </section>  
    


  </section>


</div>
  